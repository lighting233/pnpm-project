# Changesets

Hello and welcome! This folder has been automatically generated by `@changesets/cli`, a build tool that works
with multi-package repos, or single-package repos to help you version and publish your code. You can
find the full documentation for it [in our repository](https://github.com/changesets/changesets)

We have a quick list of common questions to get you started engaging with this project in
[our documentation](https://github.com/changesets/changesets/blob/main/docs/common-questions.md)

根据你的项目目录结构，`Changesets` 的配置需要考虑到以下几点：

1. **需要管理的包**：
   - `packages/utils`：这是一个独立的工具包，会单独发布。
   - `packages/cms-main` 和 `packages/cms-main-master`：这两个是主项目，可能会依赖 `utils` 和其他工具。

2. **不需要管理的包**：
   - `components` 和 `test`：这些是通过路径别名直接引入的，不需要通过 `Changesets` 管理版本和发布。

3. **Monorepo 结构**：
   - 你的项目是一个典型的 Monorepo，`Changesets` 需要正确识别哪些包是需要版本管理和发布的。

---

### Changesets 配置文件 (`.changeset/config.json`)

以下是一个适合你项目结构的 `Changesets` 配置文件：

```json
{
  "$schema": "https://unpkg.com/@changesets/config@2.0.0/schema.json",
  "changelog": "@changesets/cli/changelog",
  "commit": false,
  "fixed": [],
  "linked": [],
  "access": "public",
  "baseBranch": "main",
  "updateInternalDependencies": "patch",
  "ignore": [],
  "packages": [
    "packages/utils",
    "packages/cms-main",
    "packages/cms-main-master"
  ]
}
```

---

### 配置说明

1. **`changelog`**:
   - 指定生成 changelog 的方式。这里使用 `@changesets/cli/changelog`，它会自动生成标准的 changelog 文件。

2. **`commit`**:
   - 设置为 `false`，表示不自动提交 changeset 文件。你可以手动提交 changeset 文件。

3. **`fixed`**:
   - 如果你的项目中有需要固定版本号的包（例如多个包需要同时发布相同的版本号），可以将它们添加到 `fixed` 数组中。在你的项目中，暂时不需要固定版本号，因此留空。

4. **`linked`**:
   - 如果你的项目中有需要同步版本号的包，可以将它们添加到 `linked` 数组中。例如，如果 `cms-main` 和 `cms-main-master` 需要同步版本号，可以将它们添加到 `linked` 中：
     ```json
     "linked": [["packages/cms-main", "packages/cms-main-master"]]
     ```

5. **`access`**:
   - 设置为 `public`，表示发布的包是公开的。如果你的包是私有的，可以设置为 `restricted`。

6. **`baseBranch`**:
   - 设置基础分支为 `main`，这是当前 Git 默认分支的推荐名称。

7. **`updateInternalDependencies`**:
   - 设置为 `patch`，表示当内部依赖（例如 `utils`）更新时，依赖它的包（例如 `cms-main`）会自动更新依赖版本。

8. **`ignore`**:
   - 这里可以列出不需要通过 `Changesets` 管理的包。在你的项目中，`components` 和 `test` 不需要管理，但它们不是独立的包，因此不需要在这里配置。

9. **`packages`**:
   - 指定需要管理的包路径。在你的项目中，`packages/utils`、`packages/cms-main` 和 `packages/cms-main-master` 是需要管理的包。

---

### 使用 Changesets 的工作流程

1. **安装 Changesets**：
   ```bash
   pnpm add -Dw @changesets/cli
   ```

2. **初始化 Changesets**：
   ```bash
   pnpm changeset init
   ```

3. **创建 Changeset**：
   当你修改了某个包（例如 `utils`）并希望发布新版本时，运行以下命令：
   ```bash
   pnpm changeset
   ```
   选择需要更新的包和版本类型（`patch`、`minor`、`major`），并生成 changeset 文件。

4. **应用 Changeset**：
   当你准备好发布新版本时，运行以下命令：
   ```bash
   pnpm changeset version
   ```
   这会根据 changeset 文件更新包的版本号，并生成 changelog。

5. **发布包**：
   最后，运行以下命令发布更新后的包：
   ```bash
   pnpm changeset publish
   ```

---
